import{u as k,y as Y,c as Z,l as M,o as I,K as Q,H as L,T as G,t as _,N as U,p as W,O as $,a as w}from"./use-outside-click.2d4f8df8.js";import{x as ee,a as y,p as te,u as le}from"./use-tracked-pointer.baeceed5.js";import{f as ae,a as oe,n as ne}from"./transition.407d6a0f.js";import{d as ue,e as ie}from"./use-controllable.b6a27dd5.js";import{d as A,r as V,c as m,X as p,R as re,Y as q,y as H,Z as z,F as se,_ as K,$ as de,z as J,N as ve}from"./entry.208f3c12.js";function pe(t,S){return t===S}var ce=(t=>(t[t.Open=0]="Open",t[t.Closed=1]="Closed",t))(ce||{}),be=(t=>(t[t.Single=0]="Single",t[t.Multi=1]="Multi",t))(be||{}),fe=(t=>(t[t.Pointer=0]="Pointer",t[t.Other=1]="Other",t))(fe||{});let X=Symbol("ComboboxContext");function j(t){let S=ve(X,null);if(S===null){let R=new Error(`<${t} /> is missing a parent <Combobox /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(R,j),R}return S}let Se=A({name:"Combobox",emits:{"update:modelValue":t=>!0},props:{as:{type:[Object,String],default:"template"},disabled:{type:[Boolean],default:!1},by:{type:[String,Function],default:()=>pe},modelValue:{type:[Object,String,Number,Boolean],default:void 0},defaultValue:{type:[Object,String,Number,Boolean],default:void 0},form:{type:String,optional:!0},name:{type:String,optional:!0},nullable:{type:Boolean,default:!1},multiple:{type:[Boolean],default:!1}},inheritAttrs:!1,setup(t,{slots:S,attrs:R,emit:C}){let l=V(1),e=V(null),v=V(null),h=V(null),b=V(null),E=V({static:!1,hold:!1}),f=V([]),O=V(null),P=V(1),T=V(!1);function N(o=s=>s){let s=O.value!==null?f.value[O.value]:null,d=$(o(f.value.slice()),c=>I(c.dataRef.domRef)),u=s?d.indexOf(s):null;return u===-1&&(u=null),{options:d,activeOptionIndex:u}}let a=m(()=>t.multiple?1:0),n=m(()=>t.nullable),[r,g]=ue(m(()=>t.modelValue===void 0?k(a.value,{[1]:[],[0]:void 0}):t.modelValue),o=>C("update:modelValue",o),m(()=>t.defaultValue)),i={comboboxState:l,value:r,mode:a,compare(o,s){if(typeof t.by=="string"){let d=t.by;return(o==null?void 0:o[d])===(s==null?void 0:s[d])}return t.by(o,s)},defaultValue:m(()=>t.defaultValue),nullable:n,inputRef:v,labelRef:e,buttonRef:h,optionsRef:b,disabled:m(()=>t.disabled),options:f,change(o){g(o)},activeOptionIndex:m(()=>{if(T.value&&O.value===null&&f.value.length>0){let o=f.value.findIndex(s=>!s.dataRef.disabled);if(o!==-1)return o}return O.value}),activationTrigger:P,optionsPropsRef:E,closeCombobox(){T.value=!1,!t.disabled&&l.value!==1&&(l.value=1,O.value=null)},openCombobox(){if(T.value=!0,t.disabled||l.value===0)return;let o=f.value.findIndex(s=>{let d=p(s.dataRef.value);return k(a.value,{[0]:()=>i.compare(p(i.value.value),p(d)),[1]:()=>p(i.value.value).some(u=>i.compare(p(u),p(d)))})});o!==-1&&(O.value=o),l.value=0},goToOption(o,s,d){if(T.value=!1,t.disabled||b.value&&!E.value.static&&l.value===1)return;let u=N();if(u.activeOptionIndex===null){let x=u.options.findIndex(B=>!B.dataRef.disabled);x!==-1&&(u.activeOptionIndex=x)}let c=ee(o===y.Specific?{focus:y.Specific,id:s}:{focus:o},{resolveItems:()=>u.options,resolveActiveIndex:()=>u.activeOptionIndex,resolveId:x=>x.id,resolveDisabled:x=>x.dataRef.disabled});O.value=c,P.value=d??1,f.value=u.options},selectOption(o){let s=f.value.find(u=>u.id===o);if(!s)return;let{dataRef:d}=s;g(k(a.value,{[0]:()=>d.value,[1]:()=>{let u=p(i.value.value).slice(),c=p(d.value),x=u.findIndex(B=>i.compare(c,p(B)));return x===-1?u.push(c):u.splice(x,1),u}}))},selectActiveOption(){if(i.activeOptionIndex.value===null)return;let{dataRef:o,id:s}=f.value[i.activeOptionIndex.value];g(k(a.value,{[0]:()=>o.value,[1]:()=>{let d=p(i.value.value).slice(),u=p(o.value),c=d.findIndex(x=>i.compare(u,p(x)));return c===-1?d.push(u):d.splice(c,1),d}})),i.goToOption(y.Specific,s)},registerOption(o,s){let d={id:o,dataRef:s},u=N(c=>[...c,d]);if(O.value===null){let c=s.value.value;k(a.value,{[0]:()=>i.compare(p(i.value.value),p(c)),[1]:()=>p(i.value.value).some(x=>i.compare(p(x),p(c)))})&&(u.activeOptionIndex=u.options.indexOf(d))}f.value=u.options,O.value=u.activeOptionIndex,P.value=1},unregisterOption(o){var s;i.activeOptionIndex.value!==null&&((s=i.options.value[i.activeOptionIndex.value])==null?void 0:s.id)===o&&(T.value=!0);let d=N(u=>{let c=u.findIndex(x=>x.id===o);return c!==-1&&u.splice(c,1),u});f.value=d.options,O.value=d.activeOptionIndex,P.value=1}};Y([v,h,b],()=>i.closeCombobox(),m(()=>l.value===0)),re(X,i),Z(m(()=>k(l.value,{[0]:M.Open,[1]:M.Closed})));let F=m(()=>i.activeOptionIndex.value===null?null:f.value[i.activeOptionIndex.value].dataRef.value),D=m(()=>{var o;return(o=I(v))==null?void 0:o.closest("form")});return q(()=>{H([D],()=>{if(!D.value||t.defaultValue===void 0)return;function o(){i.change(t.defaultValue)}return D.value.addEventListener("reset",o),()=>{var s;(s=D.value)==null||s.removeEventListener("reset",o)}},{immediate:!0})}),()=>{let{name:o,disabled:s,form:d,...u}=t,c={open:l.value===0,disabled:s,activeIndex:i.activeOptionIndex.value,activeOption:F.value,value:r.value};return z(se,[...o!=null&&r.value!=null?ie({[o]:r.value}).map(([x,B])=>z(ae,Q({features:oe.Hidden,key:x,as:"input",type:"hidden",hidden:!0,readOnly:!0,form:d,name:x,value:B}))):[],L({theirProps:{...R,...G(u,["modelValue","defaultValue","nullable","multiple","onUpdate:modelValue","by"])},ourProps:{},slot:c,slots:S,attrs:R,name:"Combobox"})])}}}),Re=A({name:"ComboboxLabel",props:{as:{type:[Object,String],default:"label"},id:{type:String,default:()=>`headlessui-combobox-label-${_()}`}},setup(t,{attrs:S,slots:R}){let C=j("ComboboxLabel");function l(){var e;(e=I(C.inputRef))==null||e.focus({preventScroll:!0})}return()=>{let e={open:C.comboboxState.value===0,disabled:C.disabled.value},{id:v,...h}=t,b={id:v,ref:C.labelRef,onClick:l};return L({ourProps:b,theirProps:h,slot:e,attrs:S,slots:R,name:"ComboboxLabel"})}}}),Ie=A({name:"ComboboxInput",props:{as:{type:[Object,String],default:"input"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},displayValue:{type:Function},defaultValue:{type:String,default:void 0},id:{type:String,default:()=>`headlessui-combobox-input-${_()}`}},emits:{change:t=>!0},setup(t,{emit:S,attrs:R,slots:C,expose:l}){let e=j("ComboboxInput"),v={value:!1};l({el:e.inputRef,$el:e.inputRef});let h=m(()=>{var a;let n=e.value.value;return I(e.inputRef)?typeof t.displayValue<"u"&&n!==void 0?(a=t.displayValue(n))!=null?a:"":typeof n=="string"?n:"":""});q(()=>{H([h,e.comboboxState],([a,n],[r,g])=>{if(v.value)return;let i=I(e.inputRef);i&&(g===0&&n===1||a!==r)&&(i.value=a)},{immediate:!0}),H([e.comboboxState],([a],[n])=>{if(a===0&&n===1){let r=I(e.inputRef);if(!r)return;let g=r.value,{selectionStart:i,selectionEnd:F,selectionDirection:D}=r;r.value="",r.value=g,D!==null?r.setSelectionRange(i,F,D):r.setSelectionRange(i,F)}})});let b=V(!1);function E(){b.value=!0}function f(){setTimeout(()=>{b.value=!1})}function O(a){switch(v.value=!0,a.key){case w.Backspace:case w.Delete:if(e.mode.value!==0||!e.nullable.value)return;let n=a.currentTarget;requestAnimationFrame(()=>{if(n.value===""){e.change(null);let r=I(e.optionsRef);r&&(r.scrollTop=0),e.goToOption(y.Nothing)}});break;case w.Enter:if(v.value=!1,e.comboboxState.value!==0||b.value)return;if(a.preventDefault(),a.stopPropagation(),e.activeOptionIndex.value===null){e.closeCombobox();return}e.selectActiveOption(),e.mode.value===0&&e.closeCombobox();break;case w.ArrowDown:return v.value=!1,a.preventDefault(),a.stopPropagation(),k(e.comboboxState.value,{[0]:()=>e.goToOption(y.Next),[1]:()=>e.openCombobox()});case w.ArrowUp:return v.value=!1,a.preventDefault(),a.stopPropagation(),k(e.comboboxState.value,{[0]:()=>e.goToOption(y.Previous),[1]:()=>{e.openCombobox(),J(()=>{e.value.value||e.goToOption(y.Last)})}});case w.Home:if(a.shiftKey)break;return v.value=!1,a.preventDefault(),a.stopPropagation(),e.goToOption(y.First);case w.PageUp:return v.value=!1,a.preventDefault(),a.stopPropagation(),e.goToOption(y.First);case w.End:if(a.shiftKey)break;return v.value=!1,a.preventDefault(),a.stopPropagation(),e.goToOption(y.Last);case w.PageDown:return v.value=!1,a.preventDefault(),a.stopPropagation(),e.goToOption(y.Last);case w.Escape:if(v.value=!1,e.comboboxState.value!==0)return;a.preventDefault(),e.optionsRef.value&&!e.optionsPropsRef.value.static&&a.stopPropagation(),e.closeCombobox();break;case w.Tab:if(v.value=!1,e.comboboxState.value!==0)return;e.mode.value===0&&e.selectActiveOption(),e.closeCombobox();break}}function P(a){e.openCombobox(),S("change",a)}function T(){v.value=!1}let N=m(()=>{var a,n,r,g;return(g=(r=(n=t.defaultValue)!=null?n:e.defaultValue.value!==void 0?(a=t.displayValue)==null?void 0:a.call(t,e.defaultValue.value):null)!=null?r:e.defaultValue.value)!=null?g:""});return()=>{var a,n,r,g,i,F;let D={open:e.comboboxState.value===0},{id:o,displayValue:s,onChange:d,...u}=t,c={"aria-controls":(a=e.optionsRef.value)==null?void 0:a.id,"aria-expanded":e.disabled.value?void 0:e.comboboxState.value===0,"aria-activedescendant":e.activeOptionIndex.value===null||(n=e.options.value[e.activeOptionIndex.value])==null?void 0:n.id,"aria-labelledby":(i=(r=I(e.labelRef))==null?void 0:r.id)!=null?i:(g=I(e.buttonRef))==null?void 0:g.id,"aria-autocomplete":"list",id:o,onCompositionstart:E,onCompositionend:f,onKeydown:O,onInput:P,onBlur:T,role:"combobox",type:(F=R.type)!=null?F:"text",tabIndex:0,ref:e.inputRef,defaultValue:N.value,disabled:e.disabled.value===!0?!0:void 0};return L({ourProps:c,theirProps:u,slot:D,attrs:R,slots:C,features:U.RenderStrategy|U.Static,name:"ComboboxInput"})}}}),he=A({name:"ComboboxOptions",props:{as:{type:[Object,String],default:"ul"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},hold:{type:[Boolean],default:!1}},setup(t,{attrs:S,slots:R,expose:C}){let l=j("ComboboxOptions"),e=`headlessui-combobox-options-${_()}`;C({el:l.optionsRef,$el:l.optionsRef}),K(()=>{l.optionsPropsRef.value.static=t.static}),K(()=>{l.optionsPropsRef.value.hold=t.hold});let v=W(),h=m(()=>v!==null?(v.value&M.Open)===M.Open:l.comboboxState.value===0);return te({container:m(()=>I(l.optionsRef)),enabled:m(()=>l.comboboxState.value===0),accept(b){return b.getAttribute("role")==="option"?NodeFilter.FILTER_REJECT:b.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(b){b.setAttribute("role","none")}}),()=>{var b,E,f;let O={open:l.comboboxState.value===0},P={"aria-labelledby":(f=(b=I(l.labelRef))==null?void 0:b.id)!=null?f:(E=I(l.buttonRef))==null?void 0:E.id,id:e,ref:l.optionsRef,role:"listbox","aria-multiselectable":l.mode.value===1?!0:void 0},T=G(t,["hold"]);return L({ourProps:P,theirProps:T,slot:O,attrs:S,slots:R,features:U.RenderStrategy|U.Static,visible:h.value,name:"ComboboxOptions"})}}}),Ce=A({name:"ComboboxOption",props:{as:{type:[Object,String],default:"li"},value:{type:[Object,String,Number,Boolean]},disabled:{type:Boolean,default:!1}},setup(t,{slots:S,attrs:R,expose:C}){let l=j("ComboboxOption"),e=`headlessui-combobox-option-${_()}`,v=V(null);C({el:v,$el:v});let h=m(()=>l.activeOptionIndex.value!==null?l.options.value[l.activeOptionIndex.value].id===e:!1),b=m(()=>k(l.mode.value,{[0]:()=>l.compare(p(l.value.value),p(t.value)),[1]:()=>p(l.value.value).some(n=>l.compare(p(n),p(t.value)))})),E=m(()=>({disabled:t.disabled,value:t.value,domRef:v}));q(()=>l.registerOption(e,E)),de(()=>l.unregisterOption(e)),K(()=>{l.comboboxState.value===0&&h.value&&l.activationTrigger.value!==0&&J(()=>{var n,r;return(r=(n=I(v))==null?void 0:n.scrollIntoView)==null?void 0:r.call(n,{block:"nearest"})})});function f(n){if(t.disabled)return n.preventDefault();l.selectOption(e),l.mode.value===0&&l.closeCombobox(),ne()||requestAnimationFrame(()=>{var r;return(r=I(l.inputRef))==null?void 0:r.focus()})}function O(){if(t.disabled)return l.goToOption(y.Nothing);l.goToOption(y.Specific,e)}let P=le();function T(n){P.update(n)}function N(n){P.wasMoved(n)&&(t.disabled||h.value||l.goToOption(y.Specific,e,0))}function a(n){P.wasMoved(n)&&(t.disabled||h.value&&(l.optionsPropsRef.value.hold||l.goToOption(y.Nothing)))}return()=>{let{disabled:n}=t,r={active:h.value,selected:b.value,disabled:n},g={id:e,ref:v,role:"option",tabIndex:n===!0?void 0:-1,"aria-disabled":n===!0?!0:void 0,"aria-selected":b.value,disabled:void 0,onClick:f,onFocus:O,onPointerenter:T,onMouseenter:T,onPointermove:N,onMousemove:N,onPointerleave:a,onMouseleave:a};return L({ourProps:g,theirProps:t,slot:r,attrs:R,slots:S,name:"ComboboxOption"})}}});export{Ie as $,Re as H,Se as N,he as U,Ce as _};
